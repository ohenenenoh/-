<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>熊本 · 九州行程 · 行動版</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <!-- Tailwind CDN -->
<script src="https://cdn.tailwindcss.com"></script>
<!-- Vue 3 CDN -->
<script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
<!-- 共用資料 -->
<script src="trip-data.js"></script>


  <style>
    :root {
      --food: #f97373;
      --clothes: #facc15;
      --stay: #60a5fa;
      --transport: #22c55e;
      --free: #a855f7;
      --sight: #f97316;
      --shopping: #ec4899;
      --other: #a855f7;
    }

    body { background: #f5f3ec; }

    .app-shell {
      min-height: 100vh;
      max-width: 480px;
      margin: 0 auto;
      position: relative;
      background:
        radial-gradient(circle at 20% 10%, rgba(248, 250, 252, 0.95) 0, transparent 55%),
        radial-gradient(circle at 80% 0%, rgba(96, 165, 250, 0.18) 0, transparent 60%),
        radial-gradient(circle at 0% 60%, rgba(244, 114, 182, 0.22) 0, transparent 55%),
        radial-gradient(circle at 100% 70%, rgba(52, 211, 153, 0.22) 0, transparent 55%),
        linear-gradient(135deg, #fdfcf7 0%, #f3f1e6 45%, #ebe6da 100%);
      overflow: hidden;
    }

    .app-shell::before {
      content: "";
      position: absolute;
      inset: -40px;
      background-image:
        radial-gradient(circle, rgba(0, 0, 0, 0.04) 1px, transparent 0),
        radial-gradient(circle, rgba(0, 0, 0, 0.02) 0.8px, transparent 0);
      background-size: 18px 18px, 32px 32px;
      opacity: 0.55;
      mix-blend-mode: multiply;
      pointer-events: none;
    }

    .app-shell::after {
      content: "";
      position: absolute;
      inset: 0;
      background:
        radial-gradient(circle at 15% 75%, rgba(37, 99, 235, 0.18) 0, transparent 55%),
        conic-gradient(from 200deg at 90% 20%, rgba(15, 23, 42, 0.07), transparent 40%, rgba(15, 23, 42, 0.05), transparent 75%);
      opacity: 0.85;
      mask-image: radial-gradient(circle at 50% 50%, black 0, transparent 65%);
      pointer-events: none;
    }

    .muji-card {
      position: relative;
      background: #fbfbf7;
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.08);
      border-radius: 1.5rem;
      backdrop-filter: blur(6px);
    }

    .muji-card::before {
      content: "";
      position: absolute;
      inset: 6px;
      border-radius: 1.35rem;
      border: 1px dashed rgba(148, 163, 184, 0.6);
      opacity: 0.7;
      pointer-events: none;
    }

    .muji-pill {
      border-radius: 999px;
      border-width: 1px;
      border-style: solid;
      border-color: rgba(148, 163, 184, 0.4);
      padding: 0.3rem 0.8rem;
      background: #ffffffc4;
    }

    .timeline-dot {
      width: 11px;
      height: 11px;
      border-radius: 999px;
      border: 2px solid #0f172a;
      background: #f5f3ec;
    }

    .scrollbar-thin::-webkit-scrollbar { width: 4px; }
    .scrollbar-thin::-webkit-scrollbar-thumb {
      background-color: rgba(156, 163, 175, 0.6);
      border-radius: 999px;
    }

    .tag-food { background-color: rgba(249, 115, 115, 0.15); color: #b91c1c; border-color: rgba(248, 113, 113, 0.65); }
    .tag-clothes { background-color: rgba(250, 204, 21, 0.18); color: #92400e; border-color: rgba(250, 204, 21, 0.7); }
    .tag-stay { background-color: rgba(96, 165, 250, 0.18); color: #1d4ed8; border-color: rgba(96, 165, 250, 0.7); }
    .tag-transport { background-color: rgba(34, 197, 94, 0.18); color: #166534; border-color: rgba(34, 197, 94, 0.7); }
    .tag-free { background-color: rgba(168, 85, 247, 0.16); color: #6b21a8; border-color: rgba(168, 85, 247, 0.7); }
    .tag-sight { background-color: rgba(249, 115, 22, 0.16); color: #c2410c; border-color: rgba(249, 115, 22, 0.7); }
    .tag-shopping { background-color: rgba(236, 72, 153, 0.16); color: #9d174d; border-color: rgba(236, 72, 153, 0.7); }
    .tag-other { background-color: rgba(168, 85, 247, 0.16); color: #6b21a8; border-color: rgba(168, 85, 247, 0.7); }

    .tag-badge {
      padding: 0.18rem 0.6rem;
      border-radius: 999px;
      border-width: 1px;
      border-style: solid;
      font-size: 10px;
      line-height: 1.1;
      white-space: nowrap;
      background: #ffffffd0;
    }

    .pill-filter {
      border-radius: 999px;
      border-width: 1px;
      border-style: solid;
      border-color: rgba(148, 163, 184, 0.5);
      background: #ffffffba;
      padding: 0.25rem 0.8rem;
      font-size: 11px;
      white-space: nowrap;
    }

    .pill-filter-active {
      background: #0f172a;
      color: #f9fafb;
      border-color: transparent;
      box-shadow: 0 6px 16px rgba(15, 23, 42, 0.25);
    }

    .input-ghost {
      width: 100%;
      border-radius: 999px;
      border-width: 1px;
      border-color: rgba(209, 213, 219, 0.9);
      background-color: rgba(255, 255, 255, 0.9);
      padding: 0.2rem 0.6rem;
      font-size: 11px;
    }
    .input-ghost:focus {
      outline: none;
      box-shadow: 0 0 0 1px #0f172a33;
      border-color: #6b7280;
    }

    .input-ghost-sm {
      border-radius: 999px;
      border-width: 1px;
      border-color: rgba(209, 213, 219, 0.9);
      background-color: rgba(255, 255, 255, 0.9);
      padding: 0.1rem 0.5rem;
      font-size: 11px;
      max-width: 4.5rem;
      text-align: center;
    }
    .input-ghost-sm:focus {
      outline: none;
      box-shadow: 0 0 0 1px #0f172a33;
      border-color: #6b7280;
    }
  </style>
</head>
<body class="antialiased text-neutral-900">
<div id="app" class="app-shell flex flex-col relative z-10">

  <!-- Top App Bar -->
  <header class="px-4 pt-5 pb-3 flex items-center justify-between">
    <div class="flex items-center gap-3">
      <div class="w-9 h-9 rounded-2xl bg-neutral-900 text-neutral-50 flex items-center justify-center text-xs tracking-[0.18em]">
        TRIP
      </div>
      <div class="flex flex-col">
        <input
          v-model="tripTitle"
          class="text-base font-semibold tracking-wide text-neutral-900 bg-transparent border-none focus:outline-none focus:ring-0 px-0 py-0"
        />
        <input
          v-model="tripDate"
          class="text-[11px] text-neutral-600 bg-transparent border-none focus:outline-none focus:ring-0 px-0 py-0 mt-0.5"
        />
      </div>
    </div>
    <div class="flex items-center gap-2">
      <button
        class="text-[11px] px-3 py-1 rounded-full border border-neutral-200 bg-white/80 text-neutral-700 shadow-sm"
        @click="saveAll"
      >
        儲存
      </button>
      <button
        v-if="currentMainView === 'packing'"
        class="text-[11px] px-3 py-1 rounded-full border border-neutral-200 bg-white/80 text-neutral-700 shadow-sm"
        @click="resetAllPacking"
      >
        清除勾選
      </button>
      <button
        v-else
        class="text-[11px] px-3 py-1 rounded-full border border-neutral-200 bg-white/80 text-neutral-700 shadow-sm"
        @click="openMyMap"
      >
        地圖
      </button>
    </div>
  </header>

  <!-- Segmented Control -->
  <div class="px-4 pb-3">
    <div class="bg-neutral-900/5 rounded-full p-1 flex text-[12px] border border-neutral-200/70">
      <button
        class="flex-1 py-1.5 rounded-full transition-colors"
        :class="currentMainView === 'packing' ? 'bg-white shadow-sm text-neutral-900' : 'text-neutral-500'"
        @click="currentMainView = 'packing'"
      >
        行李清單
      </button>
      <button
        class="flex-1 py-1.5 rounded-full transition-colors"
        :class="currentMainView === 'itinerary' ? 'bg-white shadow-sm text-neutral-900' : 'text-neutral-500'"
        @click="currentMainView = 'itinerary'"
      >
        行程
      </button>
      <button
        class="flex-1 py-1.5 rounded-full transition-colors"
        :class="currentMainView === 'map' ? 'bg-white shadow-sm text-neutral-900' : 'text-neutral-500'"
        @click="currentMainView = 'map'"
      >
        地圖
      </button>
    </div>
  </div>

  <main class="flex-1 px-4 pb-5 space-y-4">

    <!-- 航班卡片 -->
    <section
      class="muji-card px-4 pt-4 pb-3"
      v-if="currentMainView === 'packing' || currentMainView === 'itinerary'"
    >
      <div class="relative z-10">
        <h2 class="text-sm font-semibold text-neutral-900 mb-2">航班資訊（可編輯）</h2>
        <div class="grid grid-cols-2 gap-3 text-[11px] text-neutral-700">
          <!-- 去程 -->
          <div class="border border-neutral-200 rounded-2xl px-3 py-2 bg-white/80 space-y-1.5">
            <p class="text-neutral-500 mb-1">去程</p>
            <div class="flex items-center gap-1">
              <span class="text-neutral-500 whitespace-nowrap">日期</span>
              <input v-model="flightInfo.depart.date" class="input-ghost" />
            </div>
            <div class="flex items-center gap-1">
              <span class="text-neutral-500 whitespace-nowrap">星期</span>
              <input v-model="flightInfo.depart.weekday" class="input-ghost" />
            </div>
            <div class="flex items-center gap-1">
              <span class="text-neutral-500 whitespace-nowrap">時間</span>
              <input v-model="flightInfo.depart.time" class="input-ghost" />
            </div>
            <div class="flex items-center gap-1">
              <span class="text-neutral-500 whitespace-nowrap">航班</span>
              <input v-model="flightInfo.depart.flightNo" class="input-ghost" />
            </div>
            <div class="flex items-center gap-1">
              <span class="text-neutral-500 whitespace-nowrap">航線</span>
              <input v-model="flightInfo.depart.route" class="input-ghost" />
            </div>
          </div>

          <!-- 回程 -->
          <div class="border border-neutral-200 rounded-2xl px-3 py-2 bg-white/80 space-y-1.5">
            <p class="text-neutral-500 mb-1">回程</p>
            <div class="flex items-center gap-1">
              <span class="text-neutral-500 whitespace-nowrap">日期</span>
              <input v-model="flightInfo.return.date" class="input-ghost" />
            </div>
            <div class="flex items-center gap-1">
              <span class="text-neutral-500 whitespace-nowrap">星期</span>
              <input v-model="flightInfo.return.weekday" class="input-ghost" />
            </div>
            <div class="flex items-center gap-1">
              <span class="text-neutral-500 whitespace-nowrap">時間</span>
              <input v-model="flightInfo.return.time" class="input-ghost" />
            </div>
            <div class="flex items-center gap-1">
              <span class="text-neutral-500 whitespace-nowrap">航班</span>
              <input v-model="flightInfo.return.flightNo" class="input-ghost" />
            </div>
            <div class="flex items-center gap-1">
              <span class="text-neutral-500 whitespace-nowrap">航線</span>
              <input v-model="flightInfo.return.route" class="input-ghost" />
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- 匯率卡片：只在行程 -->
    <section
      class="muji-card px-4 pt-4 pb-3"
      v-if="currentMainView === 'itinerary'"
    >
      <div class="relative z-10">
        <h2 class="text-sm font-semibold text-neutral-900 mb-2">匯率小工具</h2>
        <p class="text-[11px] text-neutral-500 mb-2">
          目前預設：1 TWD ≈ {{ fx.rateTwdToJpy }} JPY（可依實際匯率自行修改）
        </p>
        <div class="flex items-center gap-2 text-[11px]">
          <div class="flex-1">
            <label class="block text-neutral-500 mb-1">台幣 TWD</label>
            <input
              type="number"
              inputmode="decimal"
              v-model="fx.twd"
              @input="updateFromTwd"
              class="w-full rounded-full border border-neutral-300 px-3 py-1.5 text-[11px] bg-white/80 focus:outline-none focus:ring-1 focus:ring-neutral-500"
              placeholder="輸入台幣"
            />
          </div>
          <div class="pt-5 text-neutral-500 text-xs">≈</div>
          <div class="flex-1">
            <label class="block text-neutral-500 mb-1">日圓 JPY</label>
            <input
              type="number"
              inputmode="decimal"
              v-model="fx.jpy"
              @input="updateFromJpy"
              class="w-full rounded-full border border-neutral-300 px-3 py-1.5 text-[11px] bg-white/80 focus:outline-none focus:ring-1 focus:ring-neutral-500"
              placeholder="輸入日圓"
            />
          </div>
        </div>
      </div>
    </section>

    <!-- 行李清單模式 -->
    <template v-if="currentMainView === 'packing'">
      <!-- 打包進度 -->
      <section class="muji-card px-4 pt-4 pb-3">
        <div class="relative z-10 space-y-3">
          <div class="flex items-center justify-between">
            <div>
              <h2 class="text-sm font-semibold text-neutral-900 mb-1">行前打包進度</h2>
              <p class="text-[11px] text-neutral-500">
                已完成 {{ checkedCount }} / {{ totalCount }} 項（約 {{ progressPercent }}%）
              </p>
            </div>
            <div class="text-right">
              <button
                class="text-[10px] px-2 py-1 rounded-full bg-neutral-900 text-neutral-50 shadow-sm"
                @click="checkAllVisible(true)"
              >
                勾選篩選中
              </button>
              <button
                class="text-[10px] ml-1 px-2 py-1 rounded-full border border-neutral-300 bg-white/80 text-neutral-700"
                @click="checkAllVisible(false)"
              >
                取消篩選中
              </button>
            </div>
          </div>
          <div class="w-full h-2.5 rounded-full bg-neutral-200/70 overflow-hidden">
            <div
              class="h-full rounded-full bg-gradient-to-r from-emerald-400 via-sky-400 to-indigo-500 transition-all duration-300"
              :style="{ width: progressPercent + '%' }"
            ></div>
          </div>
          <div class="flex flex-wrap gap-2 text-[11px] text-neutral-700 mt-2">
            <button
              class="pill-filter"
              :class="filterCategory === 'all' ? 'pill-filter-active' : ''"
              @click="filterCategory = 'all'"
            >全部</button>
            <button
              class="pill-filter tag-food"
              :class="filterCategory === 'food' ? 'pill-filter-active' : ''"
              @click="filterCategory = 'food'"
            >食</button>
            <button
              class="pill-filter tag-clothes"
              :class="filterCategory === 'clothes' ? 'pill-filter-active' : ''"
              @click="filterCategory = 'clothes'"
            >衣</button>
            <button
              class="pill-filter tag-stay"
              :class="filterCategory === 'stay' ? 'pill-filter-active' : ''"
              @click="filterCategory = 'stay'"
            >住</button>
            <button
              class="pill-filter tag-transport"
              :class="filterCategory === 'transport' ? 'pill-filter-active' : ''"
              @click="filterCategory = 'transport'"
            >行</button>
            <button
              class="pill-filter tag-other"
              :class="filterCategory === 'other' ? 'pill-filter-active' : ''"
              @click="filterCategory = 'other'"
            >其他</button>
          </div>
        </div>
      </section>

      <!-- 行李項目 -->
      <section class="muji-card px-4 pt-4 pb-3">
        <div class="relative z-10">
          <div class="flex items-center justify-between mb-2">
            <h2 class="text-sm font-semibold text-neutral-900">行李項目</h2>
            <span class="text-[11px] text-neutral-500">可自行新增 / 編輯</span>
          </div>
          <div class="flex items-center gap-2 mb-3 text-[11px]">
            <input
              v-model="newItemName"
              type="text"
              class="flex-1 rounded-full border border-neutral-300 bg-white/80 px-3 py-1.5 focus:outline-none focus:ring-1 focus:ring-neutral-500"
              placeholder="新增一個行李項目，如：保溫瓶"
              @keyup.enter="addItem"
            />
            <select
              v-model="newItemCategory"
              class="rounded-full border border-neutral-300 bg-white/80 px-2 py-1.5 text-[11px] focus:outline-none focus:ring-1 focus:ring-neutral-500"
            >
              <option value="food">食</option>
              <option value="clothes">衣</option>
              <option value="stay">住</option>
              <option value="transport">行</option>
              <option value="other">其他</option>
            </select>
            <button
              @click="addItem"
              class="rounded-full bg-neutral-900 text-neutral-50 px-3 py-1.5 text-[11px] shadow-sm"
            >
              加入
            </button>
          </div>

          <div class="max-h-[60vh] overflow-y-auto pr-1 scrollbar-thin">
            <div
              v-for="(group, gIndex) in groupedItems"
              :key="gIndex"
              class="mb-4 last:mb-2"
            >
              <div class="flex items-center justify-between mb-1">
                <div class="flex items-center gap-2">
                  <span class="tag-badge" :class="categoryClass(group.category)">
                    {{ categoryLabel(group.category) }}
                  </span>
                  <p class="text-[11px] text-neutral-500">
                    {{ group.items.filter(i => i.checked).length }} / {{ group.items.length }} 已勾
                  </p>
                </div>
                <div class="flex items-center gap-1 text-[10px]">
                  <button
                    class="px-2 py-0.5 rounded-full border border-neutral-300 bg-white/80"
                    @click="toggleGroup(group.category, true)"
                  >全選</button>
                  <button
                    class="px-2 py-0.5 rounded-full border border-neutral-300 bg-white/80"
                    @click="toggleGroup(group.category, false)"
                  >全不選</button>
                </div>
              </div>

              <ul class="space-y-1.5">
                <li
                  v-for="item in group.items"
                  :key="item.id"
                  class="flex items-center justify-between rounded-2xl border border-neutral-200 bg-white/80 px-3 py-2 text-[12px]"
                >
                  <label class="flex items-center gap-2 flex-1">
                    <input
                      type="checkbox"
                      class="h-3.5 w-3.5 rounded border-neutral-300 text-neutral-900 focus:ring-neutral-700"
                      v-model="item.checked"
                    />
                    <span
                      class="transition-colors"
                      :class="item.checked ? 'line-through text-neutral-400' : 'text-neutral-800'"
                    >
                      {{ item.name }}
                    </span>
                  </label>
                  <button
                    class="ml-2 text-[11px] text-neutral-400 hover:text-red-500"
                    @click="removeItem(item.id)"
                  >
                    刪除
                  </button>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </section>
    </template>

    <!-- 行程模式 -->
    <section
      v-if="currentMainView === 'itinerary'"
      class="muji-card px-4 pt-4 pb-3"
    >
      <div class="relative z-10">
        <div class="flex items-center justify-between mb-3 gap-2">
          <div class="flex gap-2 overflow-x-auto scrollbar-thin pr-1">
            <button
              v-for="(day, index) in days"
              :key="index"
              class="px-3 py-1.5 text-[11px] rounded-full transition-all whitespace-nowrap"
              :class="currentDayIndex === index
                ? 'bg-neutral-900 text-neutral-50 shadow-sm'
                : 'bg-white/80 text-neutral-600 border border-neutral-200'"
              @click="currentDayIndex = index"
            >
              第 {{ index + 1 }} 天
            </button>
          </div>
          <div class="text-[11px] text-right text-neutral-500 min-w-[120px] flex flex-col">
            <input
              v-model="currentDay.date"
              class="bg-transparent border-none focus:outline-none focus:ring-0 px-0 py-0 mb-0.5"
            />
            <input
              v-model="currentDay.city"
              class="bg-transparent border-none focus:outline-none focus:ring-0 px-0 py-0"
            />
          </div>
        </div>

        <div class="flex flex-wrap gap-2 mb-3 text-[10px] text-neutral-600">
          <span class="tag-badge tag-food">食</span>
          <span class="tag-badge tag-clothes">衣 / 逛街</span>
          <span class="tag-badge tag-stay">住</span>
          <span class="tag-badge tag-transport">行</span>
          <span class="tag-badge tag-sight">景點</span>
          <span class="tag-badge tag-free">自由</span>
        </div>

        <div class="max-h-[60vh] overflow-y-auto pr-1 scrollbar-thin">
          <ol class="relative border-l border-neutral-200 pl-4">
            <li
              v-for="(item, idx) in currentDay.stops"
              :key="idx"
              class="mb-4 last:mb-2 relative"
            >
              <div class="absolute -left-[6px] mt-1 timeline-dot"></div>
              <div class="flex items-start justify-between gap-3">
                <div class="space-y-1">
                  <input
                    v-model="item.time"
                    class="input-ghost-sm text-[11px] font-medium text-neutral-600"
                  />
                  <input
                    v-model="item.title"
                    class="input-ghost text-sm font-semibold text-neutral-900"
                  />
                  <textarea
                    v-model="item.note"
                    rows="2"
                    class="w-full rounded-2xl border border-neutral-200 bg-white/80 px-2 py-1 text-[11px] text-neutral-600 mt-0.5 resize-none focus:outline-none focus:ring-1 focus:ring-neutral-400"
                    placeholder="備註（可留空）"
                  ></textarea>
                </div>
                <div class="flex flex-col items-end gap-1">
                  <span
                    v-if="item.category"
                    class="tag-badge"
                    :class="categoryClass(item.category)"
                  >
                    {{ categoryLabel(item.category) }}
                  </span>
                  <button
                    v-if="item.mapUrl"
                    class="text-[10px] text-sky-700 underline underline-offset-2"
                    @click="openExternalMap(item.mapUrl)"
                  >
                    地圖
                  </button>
                </div>
              </div>
            </li>
          </ol>
        </div>
      </div>
    </section>

    <!-- 地圖模式 -->
    <section
      v-if="currentMainView === 'map'"
      class="muji-card px-4 pt-4 pb-4 flex flex-col gap-3"
    >
      <div class="relative z-10">
        <p class="text-[12px] text-neutral-600">
          點擊下方按鈕，可開啟整理好的 Google 我的地圖，查看所有景點與路線。
        </p>
        <button
          class="w-full py-2.5 mt-1 text-[13px] rounded-full bg-neutral-900 text-neutral-50 font-medium shadow-sm"
          @click="openMyMap"
        >
          在 Google Maps 開啟我的地圖
        </button>
        <p class="text-[11px] text-neutral-400">
          小技巧：開啟後可以把我的地圖加入「已加星號的地點」，之後在 Google Maps 主畫面就可以快速找到。
        </p>
      </div>
    </section>
  </main>
</div>

<script>
const { createApp } = Vue;

createApp({
  data() {
    const base = window.tripData || {};
    return {
      // 從共用資料來
      tripTitle: base.tripTitle || '熊本 · 九州小旅行',
      tripDate: base.tripDate || '12/28 ～ 1/4',
      myMapUrl: base.myMapUrl || '',
      flightInfo: base.flightInfo || { depart: {}, return: {} },
      fx: base.fx || { rateTwdToJpy: 4.96, twd: '', jpy: '' },
      days: base.days || [],
      items: base.items || [],
      nextId: base.nextId || 1000,

      // 本頁自己用的狀態
      currentMainView: 'packing',
      currentDayIndex: 0,
      filterCategory: 'all',
      newItemName: '',
      newItemCategory: 'other'
    };
  },
  computed: {
    currentDay() { return this.days[this.currentDayIndex]; },
    filteredItems() {
      return this.filterCategory === 'all'
        ? this.items
        : this.items.filter(item => item.category === this.filterCategory);
    },
    groupedItems() {
      const groups = {};
      for (const item of this.filteredItems) {
        if (!groups[item.category]) groups[item.category] = [];
        groups[item.category].push(item);
      }
      return Object.keys(groups).map(cat => ({ category: cat, items: groups[cat] }));
    },
    totalCount() { return this.items.length; },
    checkedCount() { return this.items.filter(i => i.checked).length; },
    progressPercent() {
      if (!this.totalCount) return 0;
      return Math.round((this.checkedCount / this.totalCount) * 100);
    }
  },
  created() {
    this.loadAll();
  },
  methods: {
    openMyMap() { if (this.myMapUrl) window.open(this.myMapUrl, '_blank'); },
    openExternalMap(url) { window.open(url, '_blank'); },
    updateFromTwd() {
      const v = parseFloat(this.fx.twd);
      if (isNaN(v)) { this.fx.jpy = ''; return; }
      this.fx.jpy = Math.round(v * this.fx.rateTwdToJpy);
    },
    updateFromJpy() {
      const v = parseFloat(this.fx.jpy);
      if (isNaN(v) || !this.fx.rateTwdToJpy) { this.fx.twd = ''; return; }
      this.fx.twd = (v / this.fx.rateTwdToJpy).toFixed(0);
    },
    categoryClass(cat) {
      switch (cat) {
        case 'food': return 'tag-food';
        case 'clothes': return 'tag-clothes';
        case 'stay': return 'tag-stay';
        case 'transport': return 'tag-transport';
        case 'free': return 'tag-free';
        case 'sight': return 'tag-sight';
        case 'shopping': return 'tag-shopping';
        case 'other': return 'tag-other';
        default: return '';
      }
    },
    categoryLabel(cat) {
      switch (cat) {
        case 'food': return '食';
        case 'clothes': return '衣';
        case 'stay': return '住';
        case 'transport': return '行';
        case 'free': return '自由';
        case 'sight': return '景點';
        case 'shopping': return '逛街 / 購物';
        case 'other': return '其他';
        default: return cat;
      }
    },
    addItem() {
      const name = this.newItemName.trim();
      if (!name) return;
      this.items.push({
        id: this.nextId++,
        name,
        category: this.newItemCategory,
        checked: false
      });
      this.newItemName = '';
    },
    removeItem(id) {
      this.items = this.items.filter(i => i.id !== id);
    },
    toggleGroup(category, checked) {
      for (const item of this.items) {
        if (item.category === category &&
            (this.filterCategory === 'all' || this.filterCategory === category)) {
          item.checked = checked;
        }
      }
    },
    checkAllVisible(checked) {
      for (const item of this.filteredItems) item.checked = checked;
    },
    resetAllPacking() {
      for (const item of this.items) item.checked = false;
    },
    saveAll() {
      const payload = {
        tripTitle: this.tripTitle,
        tripDate: this.tripDate,
        flightInfo: this.flightInfo,
        fx: this.fx,
        days: this.days,
        items: this.items,
        nextId: this.nextId
      };
      try {
        localStorage.setItem('kyushu-trip-data', JSON.stringify(payload));
        alert('已儲存行程與行李清單到此裝置瀏覽器');
      } catch (e) {
        console.error(e);
        alert('儲存失敗，請確認瀏覽器是否允許 localStorage');
      }
    },
    loadAll() {
      try {
        const raw = localStorage.getItem('kyushu-trip-data');
        if (!raw) return;
        const data = JSON.parse(raw);
        if (data.tripTitle) this.tripTitle = data.tripTitle;
        if (data.tripDate) this.tripDate = data.tripDate;
        if (data.flightInfo) this.flightInfo = data.flightInfo;
        if (data.fx) this.fx = data.fx;
        if (Array.isArray(data.days)) this.days = data.days;
        if (Array.isArray(data.items)) this.items = data.items;
        if (typeof data.nextId === 'number') this.nextId = data.nextId;
      } catch (e) {
        console.error('載入 localStorage 失敗', e);
      }
    }
  }
}).mount('#app');
</script>


</body>
</html>


